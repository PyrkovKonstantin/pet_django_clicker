{% extends 'clicker/base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - Hamster Combat{% endblock %}

{% block content %}
<div class="balance">{{ player.balance }} –º–æ–Ω–µ—Ç</div>

<div class="energy-bar">
    <div class="energy-fill" id="energy-fill"></div>
</div>
<div class="energy-text" id="energy-text">–≠–Ω–µ—Ä–≥–∏—è: {{ player.energy }} / {{ player.max_energy }}</div>

<div class="character" id="character">üêπ</div>

<form id="click-form" method="post" action="{% url 'clicker:click' %}">
    {% csrf_token %}
    <button type="submit" class="btn" id="click-button">–ö–ª–∏–∫!</button>
</form>
{% endblock %}

{% block scripts %}
<script>
    // –û–±–Ω–æ–≤–ª—è–µ–º —à–∏—Ä–∏–Ω—É –ø–æ–ª–æ—Å—ã —ç–Ω–µ—Ä–≥–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        const energy = parseInt("{{ player.energy }}");
        const maxEnergy = parseInt("{{ player.max_energy }}");
        updateEnergy(energy, maxEnergy);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
    document.getElementById('character').addEventListener('click', function() {
        document.getElementById('click-form').dispatchEvent(new Event('submit'));
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –∫–ª–∏–∫–∞
    document.getElementById('click-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        sendPostRequest('{% url "clicker:click" %}', {}, function(data) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            updateBalance(data.new_balance);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–Ω–µ—Ä–≥–∏—é
            updateEnergy(data.new_energy, parseInt("{{ player.max_energy }}"));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            const character = document.getElementById('character');
            character.style.transform = 'scale(0.95)';
            setTimeout(() => {
                character.style.transform = 'scale(1)';
            }, 100);
        });
    });
</script>
{% endblock %}